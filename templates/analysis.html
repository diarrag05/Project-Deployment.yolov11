<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis & Re-segmentation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <h1 class="logo">YOLOv11 Segmentation Platform</h1>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/analysis" class="active">Analysis</a></li>
                <li><a href="/dashboard">Dashboard</a></li>
                <li><a href="#" onclick="checkHealth()">Status</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <section class="analysis-header">
            <h2>Advanced Analysis & Re-segmentation</h2>
            <p>Use SAM (Segment Anything Model) to refine segmentation masks with user guidance</p>
        </section>

        <div class="analysis-grid">
            <!-- Left Panel: Canvas & Controls -->
            <div class="analysis-panel left-panel">
                <h3>Interactive Canvas</h3>
                <div class="canvas-container">
                    <canvas id="analysisCanvas" width="512" height="512"></canvas>
                    <div class="canvas-info">
                        <p>Left Click: Add point | Right Click: Remove point | Scroll: Zoom</p>
                    </div>
                </div>

                <div class="segmentation-controls">
                    <h4>Segmentation Mode</h4>
                    <div class="radio-group">
                        <label><input type="radio" name="mode" value="points" checked> Point-based</label>
                        <label><input type="radio" name="mode" value="box"> Bounding Box</label>
                        <label><input type="radio" name="mode" value="auto"> Automatic</label>
                    </div>

                    <div class="point-controls" id="pointControls">
                        <button id="addPointBtn" class="btn btn-sm">Add Point</button>
                        <button id="removePointBtn" class="btn btn-sm">Remove Point</button>
                        <button id="clearPointsBtn" class="btn btn-sm">Clear All</button>
                    </div>

                    <div class="box-controls" id="boxControls" style="display: none;">
                        <p>Draw a bounding box on the canvas</p>
                        <button id="clearBoxBtn" class="btn btn-sm">Clear Box</button>
                    </div>

                    <button id="runSamBtn" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Run SAM</button>
                </div>
            </div>

            <!-- Right Panel: Results & Masks -->
            <div class="analysis-panel right-panel">
                <h3>Results</h3>
                
                <div class="results-tabs">
                    <button class="tab-btn active" data-tab="original">Original</button>
                    <button class="tab-btn" data-tab="yolo">YOLO</button>
                    <button class="tab-btn" data-tab="sam">SAM</button>
                    <button class="tab-btn" data-tab="comparison">Comparison</button>
                </div>

                <div id="original-tab" class="tab-content active">
                    <img id="originalResult" alt="Original Image" style="width: 100%;">
                </div>

                <div id="yolo-tab" class="tab-content">
                    <img id="yoloResult" alt="YOLO Segmentation" style="width: 100%;">
                </div>

                <div id="sam-tab" class="tab-content">
                    <img id="samResult" alt="SAM Segmentation" style="width: 100%;">
                </div>

                <div id="comparison-tab" class="tab-content">
                    <div class="comparison-slider">
                        <div class="img-wrapper">
                            <img id="yoloCompare" alt="YOLO" style="width: 100%;">
                            <span class="label">YOLO</span>
                        </div>
                        <input type="range" id="comparisonSlider" min="0" max="100" value="50">
                        <div class="img-wrapper">
                            <img id="samCompare" alt="SAM" style="width: 100%;">
                            <span class="label">SAM</span>
                        </div>
                    </div>
                </div>

                <div class="masks-list">
                    <h4>Detected Masks</h4>
                    <div id="masksList" class="masks-container">
                        <!-- Masks will be populated here -->
                    </div>
                </div>

                <div class="statistics-panel">
                    <h4>Statistics</h4>
                    <table>
                        <tr>
                            <td>Method</td>
                            <td id="methodName">-</td>
                        </tr>
                        <tr>
                            <td>Chip Area</td>
                            <td id="chipAreaAna">0</td>
                        </tr>
                        <tr>
                            <td>Holes Area</td>
                            <td id="holesAreaAna">0</td>
                        </tr>
                        <tr>
                            <td>Void Rate (%)</td>
                            <td id="voidRateAna">0.00</td>
                        </tr>
                        <tr>
                            <td>Confidence</td>
                            <td id="confidenceAna">0.00</td>
                        </tr>
                    </table>
                </div>

                <div class="action-buttons" style="margin-top: 20px;">
                    <button id="saveAnalysisBtn" class="btn btn-success">Save Changes</button>
                    <button id="discardBtn" class="btn btn-secondary">Discard</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 YOLOv11 Segmentation Platform</p>
    </footer>

    <script src="{{ url_for('static', filename='js/canvas.js') }}"></script>
    <script src="{{ url_for('static', filename='js/analysis.js') }}"></script>
</body>
</html>
